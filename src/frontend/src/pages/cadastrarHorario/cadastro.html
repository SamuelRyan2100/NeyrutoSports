<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastrar Horário</title>
    <link rel="stylesheet" href="styleCadastro.css">
</head>
<body>
    <div class="form-container">
        <div class="back-container">
            <button class="back-button" onclick="window.location.href='../../index.html'">
                ← Voltar
            </button>
        </div>

        <h2>Cadastrar Horário</h2>
        <form id="cadastroForm">
            <div class="form-group">
                <label for="data">Data</label>
                <input type="date" id="data" name="data" required>
            </div>

            <div class="form-group">
                <label for="inicio">Horário de Início</label>
                <input type="time" id="inicio" name="horarioInicio" required>
            </div>

            <div class="form-group">
                <label for="fim">Horário de Fim</label>
                <input type="time" id="fim" name="horarioFim" required>
            </div>

            <div class="form-group">
                <label for="tipo">Esporte</label>
                <input type="text" id="tipo" name="tipo" placeholder="Ex: Futebol, Basquete" required>
            </div>

            <div class="form-group">
                <label for="nome">Nome do Espaço Esportivo</label>
                <input type="text" id="nome" name="nome" placeholder="Ex: Quadra A, Ginásio Principal" required>
            </div>

            <div class="form-group">
                <label for="endereco">Endereço</label>
                <input type="text" id="endereco" name="endereco" placeholder="Ex: Rua Principal, 123" required>
            </div>

            <div class="form-group">
                <label for="limitePessoas">Limite de Pessoas</label>
                <input type="number" id="limitePessoas" name="limitePessoas" min="1" value="10" required>
                </div>

            <div class="form-group">
                <label for="descricao">Descrição</label>
                <textarea id="descricao" name="descricao" rows="5" placeholder="Ex: Preciso de mais 4 pessoas para completar o time..."></textarea>
                </div>

            <button type="submit">Cadastrar</button>
        </form>
    </div>

    <script>
        document.getElementById('cadastroForm').addEventListener('submit', async function(event) {
            event.preventDefault(); // Impede o envio padrão do formulário

            // Coletar os dados do formulário
            const data = document.getElementById('data').value;
            const horarioInicio = document.getElementById('inicio').value + ':00';
            const horarioFim = document.getElementById('fim').value + ':00';
            const tipo = document.getElementById('tipo').value;
            const nome = document.getElementById('nome').value;
            const endereco = document.getElementById('endereco').value;
            const limitePessoas = parseInt(document.getElementById('limitePessoas').value); // NOVO: Coleta o limite de pessoas

            // Validação simples para o novo campo
            if (isNaN(limitePessoas) || limitePessoas <= 0) {
                alert('Por favor, insira um valor válido e maior que zero para o Limite de Pessoas.');
                return;
            }

            // Validação geral
            if (!data || !horarioInicio || !horarioFim || !tipo || !nome || !endereco) {
                alert('Por favor, preencha todos os campos obrigatórios.');
                return;
            }

            // Criar o objeto com os dados para enviar como JSON
            const quadraData = {
                data: data,
                horarioInicio: horarioInicio,
                horarioFim: horarioFim,
                tipo: tipo,
                nome: nome,
                endereco: endereco,
                limitePessoas: limitePessoas // NOVO: Inclui o limite de pessoas
                // A descrição não está sendo enviada aqui porque não está no seu modelo Quadras.java
                // Se você adicionar 'private String descricao;' em Quadras.java e na coluna do DB,
                // pode incluir: descricao: document.getElementById('descricao').value,
            };

            try {
                const response = await fetch('http://localhost:8080/api/quadras/cadastrar', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(quadraData)
                });

                const result = await response.json(); // O backend retorna um JSON agora

                if (response.ok) {
                    alert(result.mensagem || 'Horário cadastrado com sucesso!');
                    document.getElementById('cadastroForm').reset(); // Limpa o formulário
                    window.location.href = '../../index.html'; // Redireciona para a home
                } else {
                    alert(result.mensagem || `Erro ao cadastrar horário: ${response.status}`);
                    console.error('Detalhes do erro:', result); // Loga o objeto de erro completo
                }
            } catch (error) {
                console.error('Erro na requisição:', error);
                alert('Não foi possível conectar ao servidor. Verifique se o backend está rodando.');
            }
        });
    </script>
</body>
</html>